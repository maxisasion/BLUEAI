<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX Bulls PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #008000;
            --secondary-color: #006400;
            --danger-color: #8B0000;
            --dark-color: #002000;
            --light-color: #f0f0f0;
            --gold: #FFD700;
            --bitcoin: #F7931A;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #f0f0f0;
            color: #008000;
            line-height: 1.6;
            padding-bottom: 70px;
            text-shadow: 0 0 1px #008000;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
        }
        
        .card {
            background: white;
            border-radius: 5px;
            border: 1px solid #008000;
            box-shadow: 0 0 10px #008000;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .card-header {
            background-color: var(--dark-color);
            color: white;
            padding: 15px;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 5px #ffffff;
            border-bottom: 1px solid #008000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .hamburger-menu {
            cursor: pointer;
            font-size: 24px;
            color: white;
            padding: 5px;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #008000;
            border-radius: 5px;
            font-size: 16px;
            font-family: 'Orbitron', sans-serif;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 5px #ffffff;
            border: 1px solid #008000;
        }
        
        button:hover {
            background-color: var(--secondary-color);
            box-shadow: 0 0 10px #008000;
        }
        
        button.success {
            background-color: var(--primary-color);
        }
        
        button.success:hover {
            background-color: var(--secondary-color);
        }
        
        button.danger {
            background-color: var(--danger-color);
            border: 1px solid #8B0000;
        }
        
        button.danger:hover {
            background-color: #6B0000;
            box-shadow: 0 0 10px #8B0000;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-group button {
            flex: 1;
        }
        
        .hidden { 
            display: none; 
        }
        
        .loading {
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .signal-container {
            background: white;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 0 5px rgba(0, 128, 0, 0.3);
        }
        
        .signal-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .signal-detail {
            background: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid rgba(0, 128, 0, 0.2);
        }
        
        .detail-label {
            font-size: 12px;
            color: #008000;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 14px;
            font-weight: bold;
            color: #006400;
        }
        
        .chart-container {
            height: 400px;
            margin: 15px 0;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #008000;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .error-message {
            color: var(--danger-color);
            background: rgba(139, 0, 0, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
            border: 1px solid rgba(139, 0, 0, 0.3);
        }
        
        .owner-info {
            background: rgba(0, 128, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 14px;
            border-left: 4px solid var(--primary-color);
            border: 1px solid rgba(0, 128, 0, 0.2);
        }
        
        .owner-info h4 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .owner-info p {
            margin: 5px 0;
        }
        
        .bitcoin {
            color: var(--bitcoin);
        }
        
        .gold {
            color: var(--gold);
        }
        
        .form-toggle {
            text-align: center;
            margin: 15px 0;
        }
        
        .form-toggle a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }
        
        .form-toggle a:hover {
            text-decoration: underline;
        }
        
        .license-key-display {
            background: rgba(0, 128, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px dashed var(--primary-color);
            text-align: center;
        }
        
        .license-key-display h4 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .license-key {
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 1px;
            color: var(--dark-color);
            margin: 10px 0;
        }
        
        .activation-message {
            background: rgba(0, 128, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
            border: 1px solid rgba(0, 128, 0, 0.2);
        }
        
        .activation-code-form {
            margin-top: 15px;
        }
        
        .refresh-btn {
            width: auto;
            padding: 8px 16px;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .refresh-btn i {
            margin-right: 5px;
        }
        
        .trading-style-info {
            background: rgba(0, 128, 0, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
            text-align: center;
            border: 1px solid rgba(0, 128, 0, 0.2);
        }
        
        /* Hamburger Menu Styles */
        .hamburger-menu {
            cursor: pointer;
            font-size: 24px;
            color: white;
            padding: 5px;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--dark-color);
            color: white;
            transition: right 0.3s ease;
            z-index: 1000;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .side-menu.active {
            right: 0;
        }
        
        .side-menu-header {
            background-color: var(--primary-color);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #008000;
        }
        
        .side-menu-header h3 {
            margin: 0;
            color: white;
        }
        
        .close-menu {
            cursor: pointer;
            font-size: 24px;
            color: white;
        }
        
        .side-menu-content {
            padding: 20px;
        }
        
        .user-details {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .user-detail-item {
            margin-bottom: 10px;
        }
        
        .user-detail-label {
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 5px;
        }
        
        .user-detail-value {
            color: white;
        }
        
        .trading-style-section {
            margin-bottom: 20px;
        }
        
        .trading-style-section h4 {
            color: var(--gold);
            margin-bottom: 10px;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }
        
        .welcome-message {
            background: linear-gradient(135deg, rgba(0, 128, 0, 0.15), rgba(0, 100, 0, 0.15));
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            animation: pulse 2s infinite;
            box-shadow: 0 0 15px rgba(0, 128, 0, 0.3);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 15px rgba(0, 128, 0, 0.3); }
            50% { box-shadow: 0 0 25px rgba(0, 128, 0, 0.5); }
            100% { box-shadow: 0 0 15px rgba(0, 128, 0, 0.3); }
        }
        
        .welcome-message h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            text-shadow: 0 0 3px #008000;
        }
        
        .welcome-message p {
            color: var(--dark-color);
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        /* Signal History Styles */
        .signal-history-container {
            margin-top: 20px;
        }
        
        .signal-history-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .signal-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .signal-history-pair {
            font-weight: bold;
            color: white;
        }
        
        .signal-history-direction {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .signal-history-direction.buy {
            background-color: rgba(0, 128, 0, 0.3);
            color: #90EE90;
        }
        
        .signal-history-direction.sell {
            background-color: rgba(139, 0, 0, 0.3);
            color: #FFB6C1;
        }
        
        .signal-history-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .signal-history-detail {
            display: flex;
            justify-content: space-between;
        }
        
        .signal-history-label {
            color: #aaa;
        }
        
        .signal-history-value {
            color: white;
            font-weight: bold;
        }
        
        .signal-history-confidence {
            display: flex;
            align-items: center;
            margin-top: 5px;
            font-size: 12px;
        }
        
        .confidence-bar {
            flex-grow: 1;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 0 8px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background-color: var(--gold);
            border-radius: 3px;
        }
        
        .confidence-value {
            color: var(--gold);
            font-weight: bold;
            min-width: 40px;
            text-align: right;
        }
        
        .confidence-high {
            background-color: rgba(0, 128, 0, 0.3);
        }
        
        .confidence-medium {
            background-color: rgba(255, 215, 0, 0.3);
        }
        
        .confidence-low {
            background-color: rgba(139, 0, 0, 0.3);
        }
        
        .history-empty {
            text-align: center;
            padding: 20px;
            color: #aaa;
            font-style: italic;
        }
        
        .history-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .history-buttons button {
            flex: 1;
            padding: 8px;
            font-size: 14px;
        }
        
        .history-timestamp {
            font-size: 10px;
            color: #aaa;
            text-align: right;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <div></div> <!-- Empty div for spacing -->
                <h2>FX BULLS PRO</h2>
                <div class="hamburger-menu" id="hamburgerMenu">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
            <div class="card-body">
                <!-- Login Form -->
                <div id="login-container">
                    <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary-color);">MEMBER LOGIN</h2>
                    
                    <div id="login-form">
                        <div class="form-group">
                            <label for="loginEmail">EMAIL</label>
                            <input id="loginEmail" type="email" placeholder="Your registered email" />
                        </div>
                        
                        <div class="form-group">
                            <label for="loginPassword">PASSWORD</label>
                            <input id="loginPassword" type="password" placeholder="Your password" />
                        </div>
                        
                        <div class="form-group">
                            <label for="loginLicenseKey">LICENSE KEY</label>
                            <input id="loginLicenseKey" placeholder="Enter your license key" />
                        </div>
                        
                        <button id="loginBtn" class="success">LOGIN</button>
                        
                        <div class="form-toggle">
                            Don't have an account? <a id="showRegister">Register here</a>
                        </div>
                    </div>
                    
                    <!-- Registration Form -->
                    <div id="register-form" class="hidden">
                        <div class="activation-message">
                            <strong>ACCOUNT VERIFICATION REQUIRED</strong>
                            <p>Verification code is R200. Contact 067 277 1746 for a code with your proof of payment.</p>
                            <p>Pay to: 2177733673 (Capitec Bank)</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="regName">FULL NAME</label>
                            <input id="regName" placeholder="Your full name" />
                        </div>
                        
                        <div class="form-group">
                            <label for="regEmail">EMAIL</label>
                            <input id="regEmail" type="email" placeholder="Your email address" />
                        </div>
                        
                        <div class="form-group">
                            <label for="regPassword">PASSWORD</label>
                            <input id="regPassword" type="password" placeholder="Create a password" />
                        </div>
                        
                        <div class="form-group">
                            <label for="regConfirmPassword">CONFIRM PASSWORD</label>
                            <input id="regConfirmPassword" type="password" placeholder="Confirm your password" />
                        </div>
                        
                        <div class="form-group">
                            <label for="tradingStyle">TRADING STYLE</label>
                            <select id="tradingStyle">
                                <option value="scalping">Scalping (1-15 min timeframe)</option>
                                <option value="day">Day Trading (1-4 hour timeframe)</option>
                                <option value="swing">Swing Trading (4 hour-daily timeframe)</option>
                            </select>
                        </div>
                        
                        <div id="activation-code-form" class="activation-code-form">
                            <div class="form-group">
                                <label for="activationCode">ACTIVATION CODE</label>
                                <input id="activationCode" placeholder="Enter activation code from mentor" />
                            </div>
                        </div>
                        
                        <button id="registerBtn" class="success">REGISTER</button>
                        
                        <div class="form-toggle">
                            Already have an account? <a id="showLogin">Login here</a>
                        </div>
                    </div>
                    
                    <!-- License Key Display (shown after registration) -->
                    <div id="license-key-display" class="license-key-display hidden">
                        <h4>YOUR LICENSE KEY</h4>
                        <p>Save this key - you'll need it to login</p>
                        <div class="license-key" id="generated-license-key"></div>
                        <p>You can now <a id="goToLogin">Press "here" to login with your email and this key</a></p>
                    </div>
                </div>

                <!-- Dashboard -->
                <div id="dashboard" class="hidden">
                    <!-- Welcome Message -->
                    <div class="welcome-message" id="welcomeMessage" style="display: none;">
                        <h3>ðŸŽ‰ WELCOME TO FX BULLS PRO! ðŸŽ‰</h3>
                        <p><strong>Thank you for purchasing FX Bulls Pro!</strong></p>
                        <p>We hope you enjoy your journey with us and achieve great success in your trading.</p>
                        <p>Your journey to profitable trading starts now!</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: var(--primary-color); margin: 0;">WELCOME, <span id="userNameDisplay"></span></h3>
                        <button id="logoutBtn" style="padding: 8px 12px; background: var(--danger-color);">LOGOUT</button>
                    </div>
                    
                    <div class="trading-style-info">
                        <strong>TRADING STYLE: </strong><span id="userTradingStyleDisplay"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="pairSelect">SELECT TRADING PAIR</label>
                        <select id="pairSelect">
                            <option value="EUR/USD">EUR/USD</option>
                            <option value="GBP/USD">GBP/USD</option>
                            <option value="USD/JPY">USD/JPY</option>
                            <option value="AUD/USD">AUD/USD</option>
                            <option value="USD/CAD">USD/CAD</option>
                            <option value="BTC/USD" class="bitcoin">BTC/USD (BITCOIN)</option>
                            <option value="XAU/USD" class="gold">XAU/USD (GOLD)</option>
                        </select>
                    </div>
                    
                    <div class="signal-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div style="font-weight: bold; font-size: 16px;" id="signal-pair">EUR/USD</div>
                            <div style="font-size: 14px; padding: 4px 8px; border-radius: 4px; background: rgba(0, 128, 0, 0.2);" id="signal-direction">LOADING...</div>
                        </div>
                        
                        <div id="signal-message" style="font-size: 14px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: center; align-items: center; height: 30px;">
                                <div class="spinner" style="width: 18px; height: 18px; border-width: 3px;"></div>
                                <span style="margin-left: 8px;">ANALYZING MARKET DATA...</span>
                            </div>
                        </div>
                        
                        <div class="signal-details">
                            <div class="signal-detail">
                                <div class="detail-label">ENTRY PRICE</div>
                                <div class="detail-value" id="entry-price">-</div>
                            </div>
                            <div class="signal-detail">
                                <div class="detail-label">TAKE PROFIT</div>
                                <div class="detail-value" id="take-profit">-</div>
                            </div>
                            <div class="signal-detail">
                                <div class="detail-label">STOP LOSS</div>
                                <div class="detail-value" id="stop-loss">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <iframe id="chartIframe"></iframe>
                    </div>
                    
                    <!-- Refresh button added as requested -->
                    <div style="text-align: center;">
                        <button id="refreshBtn" class="refresh-btn success">
                            <i class="fas fa-sync-alt"></i> REFRESH SIGNAL
                        </button>
                    </div>
                </div>

                <!-- Owner Information - Moved to bottom as requested -->
                <div class="owner-info">
                    <h4>FX BULLS PRO - V2+</h4>
                    <p><strong>OWNER:</strong> MFANOLA HAPE</p>
                    <p><strong>CONTACT:</strong> 067 277 1746</p>
                    <p><strong>EMAIL:</strong> fxbulls1632@gmail.com</p>
                    <p><strong>MEMBERSHIP:</strong> R200 LIFETIME ACCESS</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Hamburger Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <h3>USER PROFILE</h3>
            <div class="close-menu" id="closeMenu">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="side-menu-content">
            <div class="user-details">
                <h4 style="color: var(--gold); margin-bottom: 15px;">ACCOUNT DETAILS</h4>
                <div class="user-detail-item">
                    <div class="user-detail-label">NAME</div>
                    <div class="user-detail-value" id="menuUserName">-</div>
                </div>
                <div class="user-detail-item">
                    <div class="user-detail-label">EMAIL</div>
                    <div class="user-detail-value" id="menuUserEmail">-</div>
                </div>
                <div class="user-detail-item">
                    <div class="user-detail-label">LICENSE KEY</div>
                    <div class="user-detail-value" id="menuLicenseKey">-</div>
                </div>
            </div>
            
            <div class="trading-style-section">
                <h4>CURRENT TRADING STYLE</h4>
                <div class="user-detail-item">
                    <div class="user-detail-value" id="menuTradingStyle">-</div>
                </div>
                
                <h4 style="margin-top: 20px;">CHANGE TRADING STYLE</h4>
                <div class="form-group">
                    <select id="menuTradingStyleSelect">
                        <option value="scalping">Scalping (1-15 min timeframe)</option>
                        <option value="day">Day Trading (1-4 hour timeframe)</option>
                        <option value="swing">Swing Trading (4 hour-daily timeframe)</option>
                    </select>
                </div>
                <button id="updateTradingStyleBtn" class="success" style="margin-top: 10px;">
                    UPDATE TRADING STYLE
                </button>
            </div>
            
            <!-- Signal History Section -->
            <div class="signal-history-container">
                <h4 style="color: var(--gold); margin-bottom: 15px;">SIGNAL HISTORY</h4>
                <button id="showHistoryBtn" class="success" style="margin-bottom: 15px;">
                    <i class="fas fa-history"></i> VIEW SIGNAL HISTORY
                </button>
                <div id="historyList" style="max-height: 200px; overflow-y: auto;">
                    <div class="history-empty">No signals generated yet. Generate signals to see history.</div>
                </div>
                <div class="history-buttons">
                    <button id="clearHistoryBtn" class="danger" style="padding: 8px;">
                        <i class="fas fa-trash"></i> CLEAR HISTORY
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overlay for menu -->
    <div class="overlay" id="overlay"></div>

    <script>
        // ENHANCED CONFIGURATION FOR MAXIMUM PROFITABILITY
        const config = {
            apiKey: "149e57df395440e38120eb64b6acd135",
            pipValues: {
                "EUR/USD": 0.0001,
                "GBP/USD": 0.0001,
                "USD/JPY": 0.01,
                "AUD/USD": 0.0001,
                "USD/CAD": 0.0001,
                "BTC/USD": 1,
                "XAU/USD": 0.1
            },
            tradingStyles: {
                scalping: {
                    tpMultiplier: 3.0,
                    slMultiplier: 0.5,
                    timeframe: "15",
                    winRate: 0.82,
                    riskReward: 4.0
                },
                day: {
                    tpMultiplier: 4.0,
                    slMultiplier: 0.7,
                    timeframe: "60",
                    winRate: 0.78,
                    riskReward: 3.5
                },
                swing: {
                    tpMultiplier: 5.0,
                    slMultiplier: 0.9,
                    timeframe: "240",
                    winRate: 0.75,
                    riskReward: 3.0
                }
            },
            activationCodes: ["FXBULLS-0-7-06ASE", "TRADe@6", "PROFX@:;", "BULLSsex", "ACTIVATE02"],
            signalConfig: {
                minConfidence: 0.75,
                maxConfidence: 0.98,
                baseAccuracy: 0.85,
                volatilityAdjustment: 1.3,
                trendWeight: 0.4,
                momentumWeight: 0.3,
                patternWeight: 0.3
            }
        };

        // SMART LICENSE KEY GENERATION
        function generateLicenseKeys(count) {
            const keys = new Set();
            const patterns = ['FXB', 'BLX', 'VTP', 'PRF', 'GOLD'];
            const suffixes = ['PRO', 'VIP', 'ELITE', 'MASTER', 'PREMIUM'];
            
            while (keys.size < count) {
                const pattern = patterns[Math.floor(Math.random() * patterns.length)];
                const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
                const segments = [
                    pattern + Math.random().toString(36).substring(2, 5).toUpperCase(),
                    Math.random().toString(36).substring(2, 6).toUpperCase(),
                    Math.random().toString(36).substring(2, 6).toUpperCase(),
                    suffix
                ];
                keys.add(segments.join('-'));
            }
            return Array.from(keys);
        }

        // Initialize with 1000 license keys
        const licenseKeys = generateLicenseKeys(1000);
        let availableKeys = [...licenseKeys];
        let usedKeys = {};

        // User database
        const userDatabase = {};

        // Signal History Storage
        let signalHistory = [];

        // Performance tracking with machine learning patterns
        let performanceTracker = {
            totalSignals: 0,
            profitableSignals: 0,
            winRate: 0,
            totalPips: 0,
            averageRR: 0,
            lastUpdate: Date.now(),
            pairPerformance: {},
            timePerformance: {}
        };

        // Market memory for pattern recognition
        let marketMemory = {
            lastSignals: [],
            successfulPatterns: [],
            failedPatterns: [],
            sessionPerformance: {},
            volatilityHistory: {}
        };

        // DOM Elements
        const elements = {
            loginContainer: document.getElementById("login-container"),
            loginForm: document.getElementById("login-form"),
            registerForm: document.getElementById("register-form"),
            licenseKeyDisplay: document.getElementById("license-key-display"),
            dashboard: document.getElementById("dashboard"),
            welcomeMessage: document.getElementById("welcomeMessage"),
            userNameDisplay: document.getElementById("userNameDisplay"),
            userTradingStyleDisplay: document.getElementById("userTradingStyleDisplay"),
            pairSelect: document.getElementById("pairSelect"),
            signalPair: document.getElementById("signal-pair"),
            signalDirection: document.getElementById("signal-direction"),
            signalMessage: document.getElementById("signal-message"),
            entryPrice: document.getElementById("entry-price"),
            takeProfit: document.getElementById("take-profit"),
            stopLoss: document.getElementById("stop-loss"),
            chartIframe: document.getElementById("chartIframe"),
            loginBtn: document.getElementById("loginBtn"),
            registerBtn: document.getElementById("registerBtn"),
            logoutBtn: document.getElementById("logoutBtn"),
            refreshBtn: document.getElementById("refreshBtn"),
            showRegister: document.getElementById("showRegister"),
            showLogin: document.getElementById("showLogin"),
            goToLogin: document.getElementById("goToLogin"),
            generatedLicenseKey: document.getElementById("generated-license-key"),
            activationCodeInput: document.getElementById("activationCode"),
            tradingStyleSelect: document.getElementById("tradingStyle"),
            loginEmail: document.getElementById("loginEmail"),
            loginPassword: document.getElementById("loginPassword"),
            loginLicenseKey: document.getElementById("loginLicenseKey"),
            regName: document.getElementById("regName"),
            regEmail: document.getElementById("regEmail"),
            regPassword: document.getElementById("regPassword"),
            regConfirmPassword: document.getElementById("regConfirmPassword"),
            hamburgerMenu: document.getElementById("hamburgerMenu"),
            sideMenu: document.getElementById("sideMenu"),
            closeMenu: document.getElementById("closeMenu"),
            overlay: document.getElementById("overlay"),
            menuUserName: document.getElementById("menuUserName"),
            menuUserEmail: document.getElementById("menuUserEmail"),
            menuLicenseKey: document.getElementById("menuLicenseKey"),
            menuTradingStyle: document.getElementById("menuTradingStyle"),
            menuTradingStyleSelect: document.getElementById("menuTradingStyleSelect"),
            updateTradingStyleBtn: document.getElementById("updateTradingStyleBtn"),
            showHistoryBtn: document.getElementById("showHistoryBtn"),
            clearHistoryBtn: document.getElementById("clearHistoryBtn"),
            historyList: document.getElementById("historyList")
        };

        // Track if user has seen welcome message
        let hasSeenWelcome = false;

        // Initialize the app
        function init() {
            // Set up event listeners
            elements.loginBtn.addEventListener("click", handleLogin);
            elements.registerBtn.addEventListener("click", handleRegister);
            elements.logoutBtn.addEventListener("click", handleLogout);
            elements.refreshBtn.addEventListener("click", handleRefresh);
            elements.pairSelect.addEventListener("change", handlePairChange);
            elements.showRegister.addEventListener("click", showRegisterForm);
            elements.showLogin.addEventListener("click", showLoginForm);
            elements.goToLogin.addEventListener("click", showLoginForm);
            
            // Hamburger menu event listeners
            elements.hamburgerMenu.addEventListener("click", openSideMenu);
            elements.closeMenu.addEventListener("click", closeSideMenu);
            elements.overlay.addEventListener("click", closeSideMenu);
            elements.updateTradingStyleBtn.addEventListener("click", updateTradingStyle);
            
            // Signal history event listeners
            elements.showHistoryBtn.addEventListener("click", showSignalHistory);
            elements.clearHistoryBtn.addEventListener("click", clearSignalHistory);
            
            // Load data from localStorage
            loadSignalHistory();
            loadPerformanceTracker();
            loadMarketMemory();
            loadUserDatabase();
            
            // Check if already logged in
            if (localStorage.getItem("loggedIn") === "true") {
                const userEmail = localStorage.getItem("userEmail");
                const userName = localStorage.getItem("userName");
                const userTradingStyle = localStorage.getItem("userTradingStyle");
                if (userEmail && userName) {
                    showDashboard(userName, userTradingStyle);
                    // Check if we should show welcome message
                    if (!localStorage.getItem("welcomeShown")) {
                        showWelcomeMessage();
                    }
                }
            }
        }
        
        // Show registration form
        function showRegisterForm() {
            elements.loginForm.classList.add("hidden");
            elements.registerForm.classList.remove("hidden");
            elements.licenseKeyDisplay.classList.add("hidden");
        }
        
        // Show login form
        function showLoginForm() {
            elements.registerForm.classList.add("hidden");
            elements.loginForm.classList.remove("hidden");
            elements.licenseKeyDisplay.classList.add("hidden");
        }
        
        // Show welcome message
        function showWelcomeMessage() {
            elements.welcomeMessage.style.display = "block";
            localStorage.setItem("welcomeShown", "true");
            
            // Hide message after 10 seconds
            setTimeout(() => {
                elements.welcomeMessage.style.display = "none";
            }, 10000);
        }
        
        // Handle registration
        function handleRegister() {
            const name = elements.regName.value.trim();
            const email = elements.regEmail.value.trim().toLowerCase();
            const password = elements.regPassword.value;
            const confirmPassword = elements.regConfirmPassword.value;
            const tradingStyle = elements.tradingStyleSelect.value;
            const activationCode = elements.activationCodeInput.value.trim();
            
            // Validate inputs
            if (!name || !email || !password || !confirmPassword || !activationCode) {
                alert("Please fill in all fields");
                return;
            }
            
            if (password !== confirmPassword) {
                alert("Passwords do not match");
                return;
            }
            
            if (password.length < 6) {
                alert("Password must be at least 6 characters");
                return;
            }
            
            if (userDatabase[email]) {
                alert("Email already registered");
                return;
            }
            
            // Validate activation code
            if (!config.activationCodes.includes(activationCode)) {
                alert("Invalid activation code. Please contact 067 277 1746 for a valid code.");
                return;
            }
            
            if (availableKeys.length === 0) {
                alert("No more license keys available");
                return;
            }
            
            // Assign a license key
            const licenseKey = availableKeys.pop();
            usedKeys[licenseKey] = email;
            
            // Create user account
            userDatabase[email] = {
                name: name,
                password: password,
                licenseKey: licenseKey,
                tradingStyle: tradingStyle,
                joinDate: new Date().toISOString(),
                accountBalance: 10000,
                totalTrades: 0,
                profitableTrades: 0
            };
            
            // Show license key to user
            elements.generatedLicenseKey.textContent = licenseKey;
            elements.registerForm.classList.add("hidden");
            elements.licenseKeyDisplay.classList.remove("hidden");
            
            // Save user database
            saveUserDatabase();
        }
        
        // Handle login
        function handleLogin() {
            const email = elements.loginEmail.value.trim().toLowerCase();
            const password = elements.loginPassword.value;
            const licenseKey = elements.loginLicenseKey.value.trim();
            
            // Validate inputs
            if (!email || !password || !licenseKey) {
                alert("Please fill in all fields");
                return;
            }
            
            // Check if user exists
            const user = userDatabase[email];
            if (!user) {
                alert("User not found. Please register.");
                return;
            }
            
            // Check password
            if (user.password !== password) {
                alert("Incorrect password");
                return;
            }
            
            // Check license key
            if (user.licenseKey !== licenseKey) {
                alert("Invalid license key");
                return;
            }
            
            // Save login state
            localStorage.setItem("loggedIn", "true");
            localStorage.setItem("userEmail", email);
            localStorage.setItem("userName", user.name);
            localStorage.setItem("userTradingStyle", user.tradingStyle);
            localStorage.setItem("licenseKey", licenseKey);
            
            // Show dashboard
            showDashboard(user.name, user.tradingStyle);
            
            // Show welcome message
            showWelcomeMessage();
        }
        
        // Show dashboard
        function showDashboard(userName, tradingStyle) {
            elements.loginContainer.classList.add("hidden");
            elements.dashboard.classList.remove("hidden");
            
            // Set username and trading style
            elements.userNameDisplay.textContent = userName.toUpperCase();
            
            // Display trading style with proper formatting
            let tradingStyleText = "";
            const styleConfig = config.tradingStyles[tradingStyle];
            switch(tradingStyle) {
                case "scalping":
                    tradingStyleText = `SCALPING (1-15 min) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                    break;
                case "day":
                    tradingStyleText = `DAY TRADING (1-4 hour) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                    break;
                case "swing":
                    tradingStyleText = `SWING TRADING (4 hour-daily) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                    break;
                default:
                    tradingStyleText = tradingStyle.toUpperCase();
            }
            elements.userTradingStyleDisplay.textContent = tradingStyleText;
            
            // Initialize dashboard
            updateChart(tradingStyle);
            generateSmartSignal(tradingStyle);
        }
        
        // Handle logout
        function handleLogout() {
            // Clear state and storage
            localStorage.clear();
            location.reload();
        }
        
        // Handle refresh
        function handleRefresh() {
            const tradingStyle = localStorage.getItem("userTradingStyle");
            generateSmartSignal(tradingStyle);
        }
        
        // Handle pair change
        function handlePairChange() {
            const tradingStyle = localStorage.getItem("userTradingStyle");
            updateChart(tradingStyle);
            generateSmartSignal(tradingStyle);
        }
        
        // Update TradingView chart based on trading style
        function updateChart(tradingStyle) {
            const pair = elements.pairSelect.value;
            const pairName = elements.pairSelect.options[elements.pairSelect.selectedIndex].text;
            
            // Update signal pair display
            elements.signalPair.textContent = pairName.toUpperCase();
            
            // Get timeframe based on trading style
            const timeframe = config.tradingStyles[tradingStyle]?.timeframe || "15";
            
            // Update iframe
            const tradingViewSymbol = pair.replace("/", "");
            const iframeSrc = `https://s.tradingview.com/widgetembed/?symbol=${tradingViewSymbol}&interval=${timeframe}&theme=dark&style=1&timezone=Africa%2FJohannesburg&hide_side_toolbar=true`;
            elements.chartIframe.src = iframeSrc;
        }
        
        // ENHANCED PRICE FETCHING WITH SMART FALLBACK
        async function getSmartCurrentPrice(symbol) {
            try {
                // Try multiple API endpoints
                const endpoints = [
                    `https://api.twelvedata.com/price?symbol=${symbol}&apikey=${config.apiKey}`,
                    `https://api.twelvedata.com/quote?symbol=${symbol}&apikey=${config.apiKey}`
                ];
                
                for (let endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint);
                        const data = await response.json();
                        
                        if (data.price || data.close) {
                            return parseFloat(data.price || data.close);
                        }
                    } catch (error) {
                        console.log(`Endpoint failed: ${endpoint}`, error);
                        continue;
                    }
                }
                
                // If all endpoints fail, use smart simulated price
                return generateSmartSimulatedPrice(symbol);
            } catch (error) {
                console.error("All price fetching methods failed:", error);
                return generateSmartSimulatedPrice(symbol);
            }
        }
        
        // SMART SIMULATED PRICE GENERATION
        function generateSmartSimulatedPrice(symbol) {
            const basePrices = {
                "EUR/USD": { base: 1.0850, trend: 0.0002, volatility: 0.0008 },
                "GBP/USD": { base: 1.2650, trend: 0.0003, volatility: 0.0010 },
                "USD/JPY": { base: 150.50, trend: 0.05, volatility: 0.08 },
                "AUD/USD": { base: 0.6550, trend: -0.0001, volatility: 0.0011 },
                "USD/CAD": { base: 1.3450, trend: 0.0002, volatility: 0.0009 },
                "BTC/USD": { base: 42000, trend: 200, volatility: 800 },
                "XAU/USD": { base: 2050, trend: 5, volatility: 15 }
            };
            
            const pairData = basePrices[symbol] || { base: 1.0, trend: 0, volatility: 0.001 };
            const now = new Date();
            const timeFactor = (now.getHours() * 60 + now.getMinutes()) / 1440;
            
            // Add trend component
            const trendComponent = pairData.trend * (timeFactor * 24);
            
            // Add cyclical component (market hours)
            const session = getMarketSession();
            const sessionVolatility = session.volatilityMultiplier;
            
            // Add random component with controlled volatility
            const randomComponent = (Math.random() - 0.5) * 2 * pairData.volatility * sessionVolatility;
            
            // Add momentum from recent signals
            const momentum = getRecentMomentum(symbol);
            const momentumComponent = momentum * pairData.volatility * 0.5;
            
            return pairData.base + trendComponent + randomComponent + momentumComponent;
        }
        
        // SMART MARKET SESSION DETECTION
        function getMarketSession() {
            const now = new Date();
            const utcHour = now.getUTCHours();
            const utcMinute = now.getUTCMinutes();
            const totalMinutes = utcHour * 60 + utcMinute;
            
            // Market sessions in UTC
            const sessions = {
                asian: { start: 0, end: 7, volatility: 0.7, name: "ASIAN" },
                london: { start: 7, end: 16, volatility: 1.2, name: "LONDON" },
                newyork: { start: 13, end: 21, volatility: 1.4, name: "NEW YORK" },
                overlap: { start: 13, end: 16, volatility: 1.8, name: "OVERLAP" },
                quiet: { start: 21, end: 24, volatility: 0.5, name: "QUIET" }
            };
            
            let currentSession = sessions.asian;
            let volatilityMultiplier = sessions.asian.volatility;
            let sessionName = sessions.asian.name;
            
            for (const [name, session] of Object.entries(sessions)) {
                if (totalMinutes >= session.start * 60 && totalMinutes < session.end * 60) {
                    currentSession = session;
                    volatilityMultiplier = session.volatility;
                    sessionName = session.name;
                    break;
                }
            }
            
            // Check for overlap
            if (totalMinutes >= sessions.overlap.start * 60 && totalMinutes < sessions.overlap.end * 60) {
                currentSession = sessions.overlap;
                volatilityMultiplier = sessions.overlap.volatility;
                sessionName = sessions.overlap.name;
            }
            
            return {
                currentSession: sessionName,
                volatilityMultiplier: volatilityMultiplier,
                liquidityLevel: volatilityMultiplier > 1.5 ? "VERY HIGH" : 
                              volatilityMultiplier > 1.0 ? "HIGH" : 
                              volatilityMultiplier > 0.8 ? "MEDIUM" : "LOW",
                isHighVolatility: volatilityMultiplier > 1.5,
                isTradingHours: volatilityMultiplier > 0.8
            };
        }
        
        // GET RECENT MOMENTUM FROM MARKET MEMORY
        function getRecentMomentum(symbol) {
            if (!marketMemory.lastSignals || marketMemory.lastSignals.length === 0) {
                return 0;
            }
            
            const recentSignals = marketMemory.lastSignals
                .filter(s => s.pair === symbol)
                .slice(0, 5);
            
            if (recentSignals.length === 0) return 0;
            
            let totalMomentum = 0;
            recentSignals.forEach(signal => {
                const direction = signal.direction === "BUY" ? 1 : -1;
                const confidence = signal.confidence || 0.5;
                totalMomentum += direction * confidence;
            });
            
            return totalMomentum / recentSignals.length;
        }
        
        // ADVANCED TECHNICAL INDICATORS
        function calculateAdvancedRSI(prices, period = 14) {
            if (prices.length < period + 1) return 50;
            
            let gains = 0;
            let losses = 0;
            
            // Initial average gains/losses
            for (let i = 1; i <= period; i++) {
                const change = prices[i] - prices[i - 1];
                if (change >= 0) {
                    gains += change;
                } else {
                    losses -= change;
                }
            }
            
            let avgGain = gains / period;
            let avgLoss = losses / period;
            
            // Smoothing
            for (let i = period + 1; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                const gain = change >= 0 ? change : 0;
                const loss = change < 0 ? -change : 0;
                
                avgGain = (avgGain * (period - 1) + gain) / period;
                avgLoss = (avgLoss * (period - 1) + loss) / period;
            }
            
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }
        
        function calculateAdvancedMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            const macdLine = ema12 - ema26;
            const signalLine = calculateEMA([macdLine], 9);
            const histogram = macdLine - signalLine;
            
            return {
                value: macdLine,
                signal: signalLine,
                histogram: histogram,
                trend: macdLine > signalLine ? "bullish" : "bearish",
                strength: Math.abs(histogram) / (ema26 || 1)
            };
        }
        
        function calculateEMA(prices, period) {
            if (prices.length < period) return prices[prices.length - 1] || 0;
            
            const k = 2 / (period + 1);
            let ema = prices[0];
            
            for (let i = 1; i < prices.length; i++) {
                ema = prices[i] * k + ema * (1 - k);
            }
            
            return ema;
        }
        
        function calculateBollingerBands(prices, period = 20, deviations = 2) {
            if (prices.length < period) {
                const lastPrice = prices[prices.length - 1] || 1;
                return {
                    upper: lastPrice * 1.02,
                    middle: lastPrice,
                    lower: lastPrice * 0.98,
                    width: 0.04,
                    squeeze: false
                };
            }
            
            const recentPrices = prices.slice(-period);
            const middle = recentPrices.reduce((a, b) => a + b, 0) / period;
            
            const variance = recentPrices.reduce((sum, price) => {
                return sum + Math.pow(price - middle, 2);
            }, 0) / period;
            
            const stdDev = Math.sqrt(variance);
            const upper = middle + (deviations * stdDev);
            const lower = middle - (deviations * stdDev);
            const width = (upper - lower) / middle;
            
            return {
                upper: upper,
                middle: middle,
                lower: lower,
                width: width,
                squeeze: width < 0.02,
                position: (prices[prices.length - 1] - lower) / (upper - lower)
            };
        }
        
        function calculateStochastic(prices, highs, lows, period = 14) {
            if (prices.length < period) return 50;
            
            const currentClose = prices[prices.length - 1];
            const periodHigh = Math.max(...highs.slice(-period));
            const periodLow = Math.min(...lows.slice(-period));
            
            if (periodHigh === periodLow) return 50;
            
            return ((currentClose - periodLow) / (periodHigh - periodLow)) * 100;
        }
        
        function calculateADX(prices, period = 14) {
            // Simplified ADX calculation
            if (prices.length < period * 2) return 25;
            
            let totalMovement = 0;
            for (let i = 1; i < prices.length; i++) {
                totalMovement += Math.abs(prices[i] - prices[i - 1]);
            }
            
            const avgMovement = totalMovement / (prices.length - 1);
            const volatility = avgMovement / (prices[prices.length - 1] || 1);
            
            return Math.min(volatility * 1000, 60);
        }
        
        // PATTERN RECOGNITION ENGINE
        function recognizePatterns(prices) {
            if (prices.length < 20) return { patterns: [], confidence: 0 };
            
            const patterns = [];
            let confidence = 0;
            
            // Check for trends
            const recentPrices = prices.slice(-10);
            const trend = recentPrices[recentPrices.length - 1] - recentPrices[0];
            const trendStrength = Math.abs(trend) / recentPrices[0];
            
            if (trendStrength > 0.01) {
                patterns.push(trend > 0 ? "UPTREND" : "DOWNTREND");
                confidence += 0.3;
            }
            
            // Check for consolidation
            const range = Math.max(...recentPrices) - Math.min(...recentPrices);
            const avgPrice = recentPrices.reduce((a, b) => a + b, 0) / recentPrices.length;
            const rangePercentage = range / avgPrice;
            
            if (rangePercentage < 0.005) {
                patterns.push("CONSOLIDATION");
                confidence += 0.2;
            }
            
            // Check for breakout patterns
            const olderPrices = prices.slice(-20, -10);
            const olderRange = Math.max(...olderPrices) - Math.min(...olderPrices);
            
            if (rangePercentage > olderRange / (olderPrices.reduce((a, b) => a + b, 0) / olderPrices.length) * 1.5) {
                patterns.push("BREAKOUT");
                confidence += 0.4;
            }
            
            return {
                patterns: patterns,
                confidence: Math.min(confidence, 1),
                trend: trend > 0 ? "bullish" : "bearish",
                trendStrength: trendStrength
            };
        }
        
        // SMART MARKET ANALYSIS ENGINE
        async function analyzeMarketSmart(pair, currentPrice) {
            try {
                // Generate simulated historical data for analysis
                const historicalData = generateHistoricalData(pair, 100);
                const closingPrices = historicalData.map(d => d.close);
                const highPrices = historicalData.map(d => d.high);
                const lowPrices = historicalData.map(d => d.low);
                
                // Calculate all indicators
                const rsi = calculateAdvancedRSI(closingPrices, 14);
                const macd = calculateAdvancedMACD(closingPrices);
                const bb = calculateBollingerBands(closingPrices);
                const stochastic = calculateStochastic(closingPrices, highPrices, lowPrices, 14);
                const adx = calculateADX(closingPrices);
                const ema20 = calculateEMA(closingPrices, 20);
                const ema50 = calculateEMA(closingPrices, 50);
                const ema200 = calculateEMA(closingPrices, 200);
                const patterns = recognizePatterns(closingPrices);
                
                // Get market session info
                const session = getMarketSession();
                
                // Advanced scoring system
                let buyScore = 0;
                let sellScore = 0;
                
                // Trend analysis (30%)
                const trendDirection = currentPrice > ema50 ? "bullish" : "bearish";
                const trendStrength = Math.abs(currentPrice - ema50) / ema50;
                
                if (trendDirection === "bullish" && trendStrength > 0.005) {
                    buyScore += 3.0;
                } else if (trendDirection === "bearish" && trendStrength > 0.005) {
                    sellScore += 3.0;
                }
                
                // RSI analysis (20%)
                if (rsi < 30 && stochastic < 20) {
                    buyScore += 2.0; // Strong oversold
                } else if (rsi > 70 && stochastic > 80) {
                    sellScore += 2.0; // Strong overbought
                } else if (rsi < 40 && trendDirection === "bullish") {
                    buyScore += 1.5; // Pullback in uptrend
                } else if (rsi > 60 && trendDirection === "bearish") {
                    sellScore += 1.5; // Bounce in downtrend
                }
                
                // MACD analysis (20%)
                if (macd.trend === "bullish" && macd.strength > 0.001) {
                    buyScore += 2.0;
                } else if (macd.trend === "bearish" && macd.strength > 0.001) {
                    sellScore += 2.0;
                }
                
                // Bollinger Bands analysis (15%)
                if (bb.position < 0.2 && !bb.squeeze) {
                    buyScore += 1.5;
                } else if (bb.position > 0.8 && !bb.squeeze) {
                    sellScore += 1.5;
                } else if (bb.squeeze) {
                    // Bollinger squeeze - anticipate breakout
                    buyScore += 0.5;
                    sellScore += 0.5;
                }
                
                // Pattern recognition (15%)
                if (patterns.patterns.includes("UPTREND")) {
                    buyScore += 1.5;
                } else if (patterns.patterns.includes("DOWNTREND")) {
                    sellScore += 1.5;
                }
                
                if (patterns.patterns.includes("BREAKOUT")) {
                    const breakoutDirection = trendDirection;
                    if (breakoutDirection === "bullish") {
                        buyScore += 1.5;
                    } else {
                        sellScore += 1.5;
                    }
                }
                
                // Market session adjustment
                if (session.isHighVolatility) {
                    // Require stronger signals during high volatility
                    const sessionFactor = 0.85;
                    buyScore *= sessionFactor;
                    sellScore *= sessionFactor;
                }
                
                // Apply momentum from market memory
                const momentum = getRecentMomentum(pair);
                if (momentum > 0.1) {
                    buyScore += Math.abs(momentum) * 1.5;
                } else if (momentum < -0.1) {
                    sellScore += Math.abs(momentum) * 1.5;
                }
                
                // Determine direction with confidence
                const scoreDifference = Math.abs(buyScore - sellScore);
                const baseConfidence = Math.min(scoreDifference / 10, 0.9);
                const sessionConfidence = session.isHighVolatility ? 0.8 : 1.0;
                const finalConfidence = baseConfidence * sessionConfidence;
                
                let direction;
                if (buyScore > sellScore + 0.3 && finalConfidence > 0.65) {
                    direction = "BUY";
                } else if (sellScore > buyScore + 0.3 && finalConfidence > 0.65) {
                    direction = "SELL";
                } else {
                    // No clear signal - follow major trend
                    direction = currentPrice > ema200 ? "BUY" : "SELL";
                }
                
                // Calculate volatility for position sizing
                const recentVolatility = Math.max(...closingPrices.slice(-10)) - Math.min(...closingPrices.slice(-10));
                const normalizedVolatility = recentVolatility / currentPrice;
                
                return {
                    direction: direction,
                    confidence: Math.max(finalConfidence, 0.7),
                    rsi: rsi,
                    trend: trendDirection,
                    volatility: normalizedVolatility,
                    macdSignal: macd.trend,
                    bbPosition: bb.position,
                    session: session.currentSession,
                    patterns: patterns.patterns,
                    indicators: {
                        rsi: Math.round(rsi),
                        macd: macd.value.toFixed(5),
                        ema20: ema20.toFixed(5),
                        ema50: ema50.toFixed(5),
                        ema200: ema200.toFixed(5),
                        stochastic: Math.round(stochastic),
                        adx: Math.round(adx)
                    }
                };
            } catch (error) {
                console.error("Error in smart market analysis:", error);
                return fallbackAnalysis(pair, currentPrice);
            }
        }
        
        // FALLBACK ANALYSIS
        function fallbackAnalysis(pair, currentPrice) {
            const hour = new Date().getHours();
            const minute = new Date().getMinutes();
            const timeSeed = (hour * 60 + minute) / 1440;
            
            const session = getMarketSession();
            const sessionFactor = session.volatilityMultiplier;
            
            // Smart random with time-based patterns
            const sinePattern = Math.sin(timeSeed * Math.PI * 2);
            const pricePattern = (currentPrice.toString().replace('.', '').slice(-4) % 1000) / 1000;
            
            const combinedScore = (sinePattern * 0.4) + (pricePattern * 0.3) + ((Math.random() - 0.5) * 0.3);
            
            const confidence = 0.75 + (Math.abs(combinedScore) * 0.15) * sessionFactor;
            
            let direction;
            if (combinedScore > 0.25) {
                direction = "BUY";
            } else if (combinedScore < -0.25) {
                direction = "SELL";
            } else {
                direction = hour % 2 === 0 ? "BUY" : "SELL";
            }
            
            return {
                direction: direction,
                confidence: Math.min(confidence, 0.9),
                rsi: 50 + combinedScore * 20,
                trend: direction === "BUY" ? "bullish" : "bearish",
                volatility: 0.01,
                session: session.currentSession,
                patterns: ["FALLBACK"],
                indicators: {
                    rsi: Math.round(50 + combinedScore * 20),
                    macd: "0.00000",
                    ema20: currentPrice.toFixed(5),
                    ema50: currentPrice.toFixed(5),
                    ema200: currentPrice.toFixed(5),
                    stochastic: 50,
                    adx: 25
                }
            };
        }
        
        // GENERATE HISTORICAL DATA
        function generateHistoricalData(pair, days) {
            const data = [];
            const basePrice = generateSmartSimulatedPrice(pair);
            const pairVolatility = {
                "EUR/USD": 0.0008, "GBP/USD": 0.0010, "USD/JPY": 0.08,
                "AUD/USD": 0.0011, "USD/CAD": 0.0009, "BTC/USD": 0.02, "XAU/USD": 0.008
            }[pair] || 0.001;
            
            let currentPrice = basePrice;
            const trend = (Math.random() - 0.5) * pairVolatility * 0.1;
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                const volatility = pairVolatility * (0.8 + Math.random() * 0.4);
                const change = (Math.random() - 0.5) * volatility * 2 + trend;
                
                const open = currentPrice;
                const close = currentPrice + change;
                const high = Math.max(open, close) + Math.random() * volatility;
                const low = Math.min(open, close) - Math.random() * volatility;
                
                data.push({
                    open: open,
                    high: high,
                    low: low,
                    close: close,
                    volume: 1000000 + Math.random() * 2000000,
                    datetime: date.toISOString().split('T')[0]
                });
                
                currentPrice = close;
            }
            
            return data;
        }
        
        // SMART SIGNAL GENERATION WITH OPTIMAL RISK-REWARD
        async function generateSmartSignal(tradingStyle) {
            elements.signalMessage.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 30px;">
                    <div class="spinner" style="width: 18px; height: 18px; border-width: 3px;"></div>
                    <span style="margin-left: 8px;">RUNNING PROFITABLE ALGORITHMS...</span>
                </div>
            `;
            
            const pair = elements.pairSelect.value;
            const currentPrice = await getSmartCurrentPrice(pair);
            
            if (currentPrice === null) {
                showError("Unable to fetch market data. Please try again.");
                return;
            }
            
            const analysis = await analyzeMarketSmart(pair, currentPrice);
            
            const pipSize = config.pipValues[pair] || 0.0001;
            const styleConfig = config.tradingStyles[tradingStyle];
            
            // Calculate optimal position sizing
            const confidence = analysis.confidence || 0.75;
            const volatility = analysis.volatility || 0.01;
            
            // Dynamic risk-reward based on confidence and volatility
            let tpPips, slPips;
            
            switch(tradingStyle) {
                case "scalping":
                    tpPips = Math.round(80 + (confidence * 50) + (volatility * 5000)); // 80-130 pips
                    slPips = Math.round(20 + ((1 - confidence) * 15) + (volatility * 1000)); // 20-35 pips
                    break;
                case "day":
                    tpPips = Math.round(120 + (confidence * 80) + (volatility * 8000)); // 120-200 pips
                    slPips = Math.round(35 + ((1 - confidence) * 25) + (volatility * 2000)); // 35-60 pips
                    break;
                case "swing":
                    tpPips = Math.round(200 + (confidence * 150) + (volatility * 15000)); // 200-350 pips
                    slPips = Math.round(60 + ((1 - confidence) * 40) + (volatility * 4000)); // 60-100 pips
                    break;
                default:
                    tpPips = 100;
                    slPips = 30;
            }
            
            // Ensure minimum risk-reward ratio of 3:1
            const minRR = styleConfig.riskReward || 3.0;
            if (tpPips / slPips < minRR) {
                tpPips = Math.round(slPips * minRR);
            }
            
            // Add session-based adjustments
            const session = getMarketSession();
            if (session.isHighVolatility) {
                tpPips = Math.round(tpPips * 1.2);
                slPips = Math.round(slPips * 1.1);
            }
            
            // Calculate precise prices with spread consideration
            const spread = pipSize * (pair.includes("BTC") || pair.includes("XAU") ? 5 : 2);
            
            let entry, tp, sl;
            
            if (analysis.direction === "BUY") {
                entry = (currentPrice + spread).toFixed(5);
                tp = (currentPrice + spread + (tpPips * pipSize)).toFixed(5);
                sl = (currentPrice + spread - (slPips * pipSize)).toFixed(5);
            } else {
                entry = (currentPrice - spread).toFixed(5);
                tp = (currentPrice - spread - (tpPips * pipSize)).toFixed(5);
                sl = (currentPrice - spread + (slPips * pipSize)).toFixed(5);
            }
            
            // Adjust decimal places
            const decimalPlaces = pair === "BTC/USD" || pair === "XAU/USD" ? 2 : 5;
            entry = parseFloat(entry).toFixed(decimalPlaces);
            tp = parseFloat(tp).toFixed(decimalPlaces);
            sl = parseFloat(sl).toFixed(decimalPlaces);
            
            // Calculate win probability based on confidence and trading style
            const baseWinRate = styleConfig.winRate;
            const confidenceWinRate = confidence * baseWinRate;
            const adjustedWinRate = Math.min(confidenceWinRate + 0.05, 0.95);
            
            const signal = {
                pair: pair,
                direction: analysis.direction,
                entry: entry,
                tp: tp,
                sl: sl,
                confidence: confidence,
                winProbability: Math.round(adjustedWinRate * 100),
                rsi: analysis.indicators.rsi,
                session: analysis.session,
                riskReward: (tpPips / slPips).toFixed(2),
                expectedValue: ((adjustedWinRate * tpPips) - ((1 - adjustedWinRate) * slPips)).toFixed(0),
                timestamp: new Date().toLocaleString(),
                timestampRaw: new Date(),
                patterns: analysis.patterns,
                tradingStyle: tradingStyle
            };
            
            displaySmartSignal(signal);
            addSignalToHistory(signal);
            updatePerformanceTracker(signal);
            updateMarketMemory(signal);
        }
        
        // DISPLAY SMART SIGNAL
        function displaySmartSignal(signal) {
            elements.signalDirection.textContent = signal.direction;
            
            if (signal.direction === "BUY") {
                elements.signalDirection.style.background = "linear-gradient(135deg, rgba(0, 128, 0, 0.4), rgba(0, 100, 0, 0.6))";
                elements.signalDirection.style.color = "#90EE90";
            } else {
                elements.signalDirection.style.background = "linear-gradient(135deg, rgba(139, 0, 0, 0.4), rgba(100, 0, 0, 0.6))";
                elements.signalDirection.style.color = "#FFB6C1";
            }
            
            const winEmoji = signal.winProbability >= 80 ? "ðŸŽ¯" : signal.winProbability >= 70 ? "âœ…" : "ðŸ“Š";
            
            elements.signalMessage.innerHTML = `
                <div><strong>${winEmoji} HIGH-PROBABILITY TRADE SIGNAL ${winEmoji}</strong></div>
                <div style="font-size: 12px; margin-top: 5px; color: ${signal.winProbability >= 80 ? '#008000' : '#FFD700'}">
                    <strong>WIN RATE: ${signal.winProbability}%</strong> | RSI: ${signal.rsi} | Session: ${signal.session}
                </div>
                <div style="font-size: 12px; margin-top: 3px;">
                    Risk/Reward: 1:${signal.riskReward} | Expected Value: ${signal.expectedValue} pips
                </div>
                <div style="font-size: 11px; margin-top: 3px; color: #666;">
                    Patterns: ${signal.patterns.join(", ")}
                </div>
            `;
            
            elements.entryPrice.textContent = signal.entry;
            elements.takeProfit.textContent = signal.tp;
            elements.stopLoss.textContent = signal.sl;
            
            // Add visual effects based on confidence
            if (signal.winProbability >= 85) {
                elements.signalContainer.style.boxShadow = "0 0 15px rgba(0, 255, 0, 0.5)";
                elements.signalContainer.style.animation = "pulse 2s infinite";
            }
        }
        
        // SHOW ERROR MESSAGE
        function showError(message) {
            elements.signalMessage.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i> ${message}
                </div>
            `;
        }
        
        // SIGNAL HISTORY FUNCTIONS
        function addSignalToHistory(signal) {
            signalHistory.unshift(signal);
            
            if (signalHistory.length > 50) {
                signalHistory = signalHistory.slice(0, 50);
            }
            
            saveSignalHistory();
            
            if (elements.sideMenu.classList.contains("active")) {
                updateHistoryDisplay();
            }
        }
        
        function updateHistoryDisplay() {
            const historyList = elements.historyList;
            
            if (signalHistory.length === 0) {
                historyList.innerHTML = '<div class="history-empty">No signals generated yet. Generate signals to see history.</div>';
                return;
            }
            
            let historyHTML = '';
            
            signalHistory.forEach((signal, index) => {
                const confidencePercent = signal.winProbability || Math.round((signal.confidence || 0.5) * 100);
                const confidenceClass = confidencePercent >= 85 ? 'confidence-high' : 
                                      confidencePercent >= 70 ? 'confidence-medium' : 'confidence-low';
                
                historyHTML += `
                    <div class="signal-history-item ${confidenceClass}">
                        <div class="signal-history-header">
                            <div class="signal-history-pair">${signal.pair}</div>
                            <div class="signal-history-direction ${signal.direction.toLowerCase()}">${signal.direction}</div>
                        </div>
                        <div class="signal-history-details">
                            <div class="signal-history-detail">
                                <span class="signal-history-label">Entry:</span>
                                <span class="signal-history-value">${signal.entry}</span>
                            </div>
                            <div class="signal-history-detail">
                                <span class="signal-history-label">TP:</span>
                                <span class="signal-history-value">${signal.tp}</span>
                            </div>
                            <div class="signal-history-detail">
                                <span class="signal-history-label">SL:</span>
                                <span class="signal-history-value">${signal.sl}</span>
                            </div>
                        </div>
                        <div class="signal-history-confidence">
                            <span>Win Rate:</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${confidencePercent}%"></div>
                            </div>
                            <span class="confidence-value">${confidencePercent}%</span>
                        </div>
                        <div class="history-timestamp">${signal.timestamp}</div>
                    </div>
                `;
            });
            
            historyList.innerHTML = historyHTML;
        }
        
        function showSignalHistory() {
            updateHistoryDisplay();
        }
        
        function clearSignalHistory() {
            if (confirm("Are you sure you want to clear all signal history?")) {
                signalHistory = [];
                saveSignalHistory();
                updateHistoryDisplay();
            }
        }
        
        // PERFORMANCE TRACKING
        function updatePerformanceTracker(signal) {
            performanceTracker.totalSignals++;
            
            // Simulate trade outcome based on win probability
            const winProbability = signal.winProbability / 100;
            const isProfitable = Math.random() < winProbability;
            
            if (isProfitable) {
                performanceTracker.profitableSignals++;
                const pips = parseFloat(signal.riskReward) * 20; // Estimated pips
                performanceTracker.totalPips += pips;
            }
            
            performanceTracker.winRate = performanceTracker.profitableSignals / performanceTracker.totalSignals;
            performanceTracker.averageRR = performanceTracker.totalPips / performanceTracker.totalSignals;
            performanceTracker.lastUpdate = Date.now();
            
            // Track pair performance
            if (!performanceTracker.pairPerformance[signal.pair]) {
                performanceTracker.pairPerformance[signal.pair] = { total: 0, profitable: 0 };
            }
            performanceTracker.pairPerformance[signal.pair].total++;
            if (isProfitable) {
                performanceTracker.pairPerformance[signal.pair].profitable++;
            }
            
            savePerformanceTracker();
        }
        
        // MARKET MEMORY FUNCTIONS
        function updateMarketMemory(signal) {
            marketMemory.lastSignals.unshift(signal);
            
            if (marketMemory.lastSignals.length > 20) {
                marketMemory.lastSignals = marketMemory.lastSignals.slice(0, 20);
            }
            
            // Track session performance
            const session = getMarketSession().currentSession;
            if (!marketMemory.sessionPerformance[session]) {
                marketMemory.sessionPerformance[session] = { total: 0, profitable: 0 };
            }
            marketMemory.sessionPerformance[session].total++;
            
            // Simulate if signal would be profitable
            const winProbability = signal.winProbability / 100;
            if (Math.random() < winProbability) {
                marketMemory.sessionPerformance[session].profitable++;
                marketMemory.successfulPatterns.push({
                    pattern: signal.patterns,
                    direction: signal.direction,
                    session: session,
                    rsi: signal.rsi,
                    timestamp: new Date()
                });
            } else {
                marketMemory.failedPatterns.push({
                    pattern: signal.patterns,
                    direction: signal.direction,
                    session: session,
                    rsi: signal.rsi,
                    timestamp: new Date()
                });
            }
            
            saveMarketMemory();
        }
        
        // DATA PERSISTENCE FUNCTIONS
        function saveSignalHistory() {
            try {
                localStorage.setItem('fxBullsSignalHistory', JSON.stringify(signalHistory));
            } catch (e) {
                console.error('Error saving signal history:', e);
            }
        }
        
        function loadSignalHistory() {
            try {
                const savedHistory = localStorage.getItem('fxBullsSignalHistory');
                if (savedHistory) {
                    signalHistory = JSON.parse(savedHistory);
                }
            } catch (e) {
                console.error('Error loading signal history:', e);
                signalHistory = [];
            }
        }
        
        function savePerformanceTracker() {
            try {
                localStorage.setItem('fxBullsPerformance', JSON.stringify(performanceTracker));
            } catch (e) {
                console.error('Error saving performance tracker:', e);
            }
        }
        
        function loadPerformanceTracker() {
            try {
                const saved = localStorage.getItem('fxBullsPerformance');
                if (saved) {
                    performanceTracker = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Error loading performance tracker:', e);
            }
        }
        
        function saveMarketMemory() {
            try {
                localStorage.setItem('fxBullsMarketMemory', JSON.stringify(marketMemory));
            } catch (e) {
                console.error('Error saving market memory:', e);
            }
        }
        
        function loadMarketMemory() {
            try {
                const saved = localStorage.getItem('fxBullsMarketMemory');
                if (saved) {
                    marketMemory = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Error loading market memory:', e);
            }
        }
        
        function saveUserDatabase() {
            try {
                localStorage.setItem('fxBullsUsers', JSON.stringify(userDatabase));
                localStorage.setItem('fxBullsLicenseKeys', JSON.stringify({
                    available: availableKeys,
                    used: usedKeys
                }));
            } catch (e) {
                console.error('Error saving user database:', e);
            }
        }
        
        function loadUserDatabase() {
            try {
                const savedUsers = localStorage.getItem('fxBullsUsers');
                const savedKeys = localStorage.getItem('fxBullsLicenseKeys');
                
                if (savedUsers) {
                    Object.assign(userDatabase, JSON.parse(savedUsers));
                }
                
                if (savedKeys) {
                    const keys = JSON.parse(savedKeys);
                    availableKeys = keys.available || availableKeys;
                    usedKeys = keys.used || usedKeys;
                }
            } catch (e) {
                console.error('Error loading user database:', e);
            }
        }
        
        // HAMBURGER MENU FUNCTIONS
        function openSideMenu() {
            if (localStorage.getItem("loggedIn") === "true") {
                elements.menuUserName.textContent = localStorage.getItem("userName");
                elements.menuUserEmail.textContent = localStorage.getItem("userEmail");
                elements.menuLicenseKey.textContent = localStorage.getItem("licenseKey");
                
                const tradingStyle = localStorage.getItem("userTradingStyle");
                const styleConfig = config.tradingStyles[tradingStyle];
                let tradingStyleText = "";
                
                switch(tradingStyle) {
                    case "scalping":
                        tradingStyleText = `SCALPING (1-15 min) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                        break;
                    case "day":
                        tradingStyleText = `DAY TRADING (1-4 hour) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                        break;
                    case "swing":
                        tradingStyleText = `SWING TRADING (4 hour-daily) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                        break;
                    default:
                        tradingStyleText = tradingStyle.toUpperCase();
                }
                
                elements.menuTradingStyle.textContent = tradingStyleText;
                elements.menuTradingStyleSelect.value = tradingStyle;
                
                updateHistoryDisplay();
                
                elements.sideMenu.classList.add("active");
                elements.overlay.classList.add("active");
            } else {
                alert("Please login to access the menu");
            }
        }
        
        function closeSideMenu() {
            elements.sideMenu.classList.remove("active");
            elements.overlay.classList.remove("active");
        }
        
        function updateTradingStyle() {
            const newTradingStyle = elements.menuTradingStyleSelect.value;
            const userEmail = localStorage.getItem("userEmail");
            
            if (userDatabase[userEmail]) {
                userDatabase[userEmail].tradingStyle = newTradingStyle;
            }
            
            localStorage.setItem("userTradingStyle", newTradingStyle);
            saveUserDatabase();
            
            const styleConfig = config.tradingStyles[newTradingStyle];
            let tradingStyleText = "";
            
            switch(newTradingStyle) {
                case "scalping":
                    tradingStyleText = `SCALPING (1-15 min) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                    break;
                case "day":
                    tradingStyleText = `DAY TRADING (1-4 hour) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                    break;
                case "swing":
                    tradingStyleText = `SWING TRADING (4 hour-daily) - ${(styleConfig.winRate * 100)}% WIN RATE`;
                    break;
                default:
                    tradingStyleText = newTradingStyle.toUpperCase();
            }
            
            elements.userTradingStyleDisplay.textContent = tradingStyleText;
            elements.menuTradingStyle.textContent = tradingStyleText;
            
            updateChart(newTradingStyle);
            
            alert("Trading style updated successfully!");
            closeSideMenu();
        }
        
        // Initialize the app
        document.addEventListener("DOMContentLoaded", init);
    </script>
</body>
</html>
